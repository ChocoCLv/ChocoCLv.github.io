---
title: Redis-高可用
comments: true
typora-root-url: ../../source/
date: 2020-01-03 10:48:50
tags:
- redis
- 集群
- Sentinel
- 哨兵
- Cluster
- 主从
---

Redis支持三种集群模式：主从、Sentinel、Cluster。

<!--more-->

# Redis高可用

## 主从模式

- 一对多；

- Slave挂了不影响其他Slave的读和Master的读写；

- 提供最终一致性，主节点写入成功后即返回；
- 目的是高可用，而不是读写分离

## Sentinel（哨兵）模式

对比主从模式，增加了哨兵监控主从节点的状态，从而进行自动故障迁移。

- 主节点拥有所有哨兵节点和从节点的信息
- 客户端初始化时连接哨兵节点，获取主节点信息
- 存在多个哨兵节点，保证高可用
- 哨兵节点通过从主节点获取其他哨兵节点和从节点的信息
- 哨兵节点与主节点是多对多的关系
- 哨兵集合和masterName是客户端启动时需要知道的配置，这部分可以使用配置发现服务动态配置
- 使用raft算法进行哨兵中的领导者选举，由领导者负责故障迁移。
- **哨兵只是配置中心，而不是代理**
- 可以依赖哨兵节点的日志实现读写分离，客户端实现。

## Cluster模式

- 使用哈希对数据进行分区，增加数据容量，（取余分区，一致性哈希，虚拟槽分区√），包含16384(14bit)个槽。
- 只能对具有相同slot值的key执行批量操作，从节点只能从主节点复制
- 集群节点启动后通过握手建立拓扑关系，分配槽后节点才能提供服务。可以手动指定节点成为从节点。提供了集群管理工具。
- gossip消息：meet、ping、pong、fail
- 集群伸缩==槽和数据在节点之间的移动
- 客户端直连节点，而不是通过代理，节点提供重定向命令。


---
title: Kafka核心知识点
typora-root-url: ../../source/
date: 2019-10-28 15:20:22
tags:
- kafka
- 消息队列
- 分布式
---



Kafka是一种高吞吐量/分布式/基于发布订阅的消息系统。

# Kafka

## 基本概念

- broker：Kafka服务器，负责消息存储和转发
- topic：消息类别，Kafka按照topic分类消息
- partition：topic的分区，一个topic包含多个partition，topic消息保存在各个partition上
- offset：消息在日志中的位置，在partition上的偏移量，也是消息的唯一序号
- Producer：消息生产者
- Consumer：消息消费者
- Consumer Group：每个Consumer必须属于一个group
- Zookeeper：保存集群broker topic partition等meta数据，负责broker故障发现，partition leader选举，负载均衡。

## 数据存储设计

1. partition的数据文件

partition的每条Message包含了以下三个属性：offset，MessageSize，data。

offset表示Message在这个partition中的偏移量，不是该Message在partition数据文件中的实际存储位置，而是一个逻辑值。可以认为是partition中的MessageID。

2. 数据文件分段segment（顺序读写，分段存储，二分查找）

partition物理上由多个segment文件组成，每个segment大小相等，顺序读写。segment以该段中最小的offset命名。在查找指定offset的Message时可以用二分查找快速定位。

3. 数据文件索引（分段索引，稀疏存储）

为每个分段后的数据文件建立了索引文件，并没有为数据文件中的每条Message建立索引，而是每隔一定字节的数据建立索引。

避免索引文件占用过多空间，从而将索引文件保留在内存中。

## 生产者设计



## 消费者设计




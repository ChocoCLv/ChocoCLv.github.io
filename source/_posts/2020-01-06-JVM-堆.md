---
title: 'JVM:堆'
comments: true
typora-root-url: ../../source/
date: 2020-01-06 10:54:00
tags:
- JVM
- 内存区域
- 堆
---

在菜鸟补招面试中被问到

> 详细讲讲堆吧。

竟一时不知从何说起。面试完才想起来：

1. JVM垃圾回收不就主要针对的堆区域吗，至少可以说说年轻代和老年代等。
2. 实例对象都是放在堆中的，那还可以说下实例对象的组成：Markword、实例数据和填充等。

<!--more-->

# JVM的堆

## 堆内存区域组成

https://blog.csdn.net/lingbo229/article/details/82586822

<img src="/imgs/image-20200106112021513.png" alt="image-20200106112021513" style="zoom:50%;" />

1. JVM 内存划分为堆内存和非堆内存，堆内存分为年轻代（Young Generation）、老年代（Old Generation），非堆内存就一个永久代（Permanent Generation）。
2. 年轻代又分为 Eden 和 Survivor 区。Survivor 区由 FromSpace 和 ToSpace 组成。Eden 区占大容量，Survivor 两个区占小容量，默认比例是 8:1:1。
3. 堆内存用途：存放的是对象，垃圾收集器就是收集这些对象，然后根据 GC 算法回收。
4. 非堆内存用途：永久代，也称为方法区，存储程序运行时长期存活的对象，比如类的元数据、方法、常量、属性等。

在 JDK1.8 版本废弃了永久代，替代的是元空间（MetaSpace），元空间与永久代上类似，都是方法区的实现，他们最大区别是：元空间并不在 JVM 中，而是使用本地内存。
元空间有注意有两个参数：

- MetaspaceSize ：初始化元空间大小，控制发生 GC 阈值
- MaxMetaspaceSize ： 限制元空间大小上限，防止异常占用过多物理内存

## 实例对象

<img src="/imgs/image-20200106112332962.png" alt="image-20200106112332962" style="zoom:50%;" />

<img src="/imgs/image-20200106112402329.png" alt="image-20200106112402329" style="zoom:50%;" />

![image-20200106112633048](/imgs/image-20200106112633048.png)



​	<img src="/imgs/image-20200106112649242.png" alt="image-20200106112649242" style="zoom:50%;" />
---
title: 'Redis:持久化'
typora-root-url: ../../source/
date: 2019-09-16 00:04:06
tags:
---

# 简介

Redis支持RDB和AOF持久化机制，注意持久化机制并不完全等同于主从复制原理。

# RDB

## 触发机制

将当前进程数据生成快照保存到硬盘。RDB持久化可以手动触发也可以自动触发。

| 触发机制 | 触发方式                                   |      |
| -------- | ------------------------------------------ | ---- |
| 手动触发 | save：阻塞当前服务器直到持久化完成，以废弃 |      |
|          | bgsave：fork子进程，阻塞只发生在fork阶段   |      |
| 自动触发 | save m n：m秒内达到n次修改时触发           |      |
|          | 从节点执行全量复制，主节点自动bgsave       |      |
|          | debug reload                               |      |
|          | shutdown时如果没有开启AOF则bgsave          |      |

## bgsave流程

![1568637625579](/imgs/1568637625579.png)

## RDB文件的处理

- 默认采用LZF算法进行压缩，压缩后的文件大小远远小于内存大小，默认开启
- 加载损坏的RDB文件时拒绝启动

